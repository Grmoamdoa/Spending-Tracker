<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Spending & Shopping Tracker</title>
  <meta name="description" content="Mobile-first shopping list & spending tracker with photo receipts, analytics, and local-only storage." />
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Body markup only. Styles are in styles.css, logic in app.js -->
  <header>
    <div class="row" style="justify-content:space-between">
      <div class="row" style="gap:10px">
        <div class="title">🛍️ Shopping Tracker</div>
        <span id="budgetStatus" class="pill ok" title="Budget status">On Track</span>
      </div>
      <div class="row">
        <select id="listSelect" aria-label="Select shopping list"></select>
        <button id="manageListsBtn" class="ghost">Lists & Groups</button>
      </div>
    </div>
    <div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap">
      <div class="chip" title="Total items in this list"><span>🧮</span><span id="totalItems">0 items</span></div>
      <div class="chip" title="Total spent in this list"><span>💵</span><span id="totalSpent">$0.00</span></div>
      <div class="chip" title="Photos vs no photos"><span>📷</span><span id="photoRatio">0 / 0</span></div>
    </div>
  </header>

  <main class="container">
    <section class="card" aria-labelledby="addItemHeading">
      <h2 id="addItemHeading" class="sr">Add Item</h2>
      <div class="input-grid">
        <input id="itemName" type="text" placeholder="Item name" autocomplete="off" />
        <input id="itemPrice" type="number" step="0.01" min="0" inputmode="decimal" placeholder="$ Price" />
        <button id="photoTrigger" class="photo-btn" title="Add a price tag photo">📸</button>
      </div>
      <input id="photoInput" class="sr" type="file" accept="image/*" capture="environment" />
      <div id="photoPreviewWrap" style="display:none;margin-top:10px" class="row">
        <img id="photoPreview" alt="Photo preview" style="max-height:120px;border-radius:12px" />
        <button id="clearPreview" class="ghost" title="Remove photo">Remove</button>
      </div>
      <div class="row" style="margin-top:10px;justify-content:space-between;gap:8px">
        <span class="hint">Tip: tap 📸 to use your phone camera.</span>
        <button id="addItemBtn" class="primary">Add Item</button>
      </div>
    </section>

    <div class="space"></div>

    <section aria-labelledby="itemsHeading">
      <h2 id="itemsHeading" class="sr">Items</h2>
      <div id="itemsGrid" class="items"></div>
    </section>
  </main>

  <nav class="nav" aria-label="Primary">
    <div class="bar">
      <button id="photosBtn">📷 Photos</button>
      <button id="analyticsBtn">📊 Analytics</button>
      <button id="exportBtn">📤 Export/Import</button>
      <button id="clearListBtn" class="danger">🗑️ Clear List</button>
    </div>
  </nav>

  <!-- Manage Lists & Groups Modal -->
  <dialog id="listsModal">
    <div class="modal-head">
      <div class="title">Lists & Groups</div>
      <button data-close class="ghost">✖</button>
    </div>
    <div class="modal-body">
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <input id="newListName" type="text" placeholder="New list name (e.g., Costco Run)" style="flex:1" />
        <input id="newListBudget" type="number" step="0.01" min="0" placeholder="Budget (optional)" style="width:160px" />
        <button id="addList" class="primary">Add List</button>
      </div>
      <div class="divider"></div>
      <div id="listsContainer"></div>

      <div class="divider"></div>
      <div class="row" style="justify-content:space-between;align-items:center">
        <div class="title" style="font-size:16px">List Groups</div>
        <div class="row" style="gap:8px">
          <input id="newGroupName" type="text" placeholder="New group name (e.g., Cuba Vacation)" />
          <button id="addGroup" class="ghost">Add Group</button>
        </div>
      </div>
      <div id="groupsContainer" style="margin-top:8px"></div>
    </div>
    <div class="modal-foot">
      <button data-close class="ghost">Close</button>
    </div>
  </dialog>

  <!-- Photos Modal -->
  <dialog id="photosModal">
    <div class="modal-head">
      <div class="title">Photo Gallery</div>
      <button data-close class="ghost">✖</button>
    </div>
    <div class="modal-body">
      <div id="gallery" class="gallery"></div>
    </div>
    <div class="modal-foot">
      <button data-close class="ghost">Close</button>
    </div>
  </dialog>

  <!-- Analytics Modal -->
  <dialog id="analyticsModal">
    <div class="modal-head">
      <div class="title">Analytics</div>
      <button data-close class="ghost">✖</button>
    </div>
    <div class="modal-body">
      <div class="stats">
        <div class="stat"><div class="h">Current List – Total Spent</div><div id="statListSpent" class="v">$0.00</div></div>
        <div class="stat"><div class="h">Current List – Items</div><div id="statListItems" class="v">0</div></div>
        <div class="stat"><div class="h">With Photos</div><div id="statWithPhotos" class="v">0</div></div>
        <div class="stat"><div class="h">Without Photos</div><div id="statNoPhotos" class="v">0</div></div>
      </div>
      <div class="divider"></div>
      <div class="row" style="gap:8px;flex-wrap:wrap;align-items:center">
        <div class="chip">📅 Monthly Spending (Global)</div>
        <button id="filtersBtn" class="ghost">Filters</button>
      </div>
      <canvas id="chart" height="220" aria-label="Monthly spending chart"></canvas>

      <div class="divider"></div>
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <div class="stat" style="flex:1"><div class="h">Most Expensive (Current)</div><div id="statMost" class="v">—</div></div>
        <div class="stat" style="flex:1"><div class="h">Least Expensive (Current)</div><div id="statLeast" class="v">—</div></div>
      </div>
    </div>
    <div class="modal-foot">
      <button data-close class="ghost">Close</button>
    </div>
  </dialog>

  <!-- Filters Modal -->
  <dialog id="filtersModal">
    <div class="modal-head">
      <div class="title">Analytics Filters</div>
      <button data-close class="ghost">✖</button>
    </div>
    <div class="modal-body">
      <div style="font-weight:700;margin-bottom:6px">Include Lists</div>
      <div id="filtersLists"></div>
      <div class="divider"></div>
      <div style="font-weight:700;margin-bottom:6px">Or pick a Group</div>
      <div id="filtersGroups"></div>
    </div>
    <div class="modal-foot">
      <button id="applyFilters" class="primary">Apply</button>
      <button data-close class="ghost">Cancel</button>
    </div>
  </dialog>

  <!-- Export/Import Modal -->
  <dialog id="exportModal">
    <div class="modal-head">
      <div class="title">Export / Import</div>
      <button data-close class="ghost">✖</button>
    </div>
    <div class="modal-body">
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <button id="exportCurrentJSON" class="ghost">Export Current List (JSON)</button>
        <button id="exportAllJSON" class="ghost">Export All Lists & Groups (JSON)</button>
        <button id="exportCSV" class="ghost">Export Selected → CSV</button>
      </div>
      <div class="divider"></div>
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <input id="importFile" type="file" accept="application/json" />
        <button id="importBtn" class="primary">Import JSON</button>
      </div>
      <p class="hint">CSV exports include: List, Item, Price, Timestamp, HasPhoto.</p>
      <div class="divider"></div>
      <div>
        <div style="font-weight:700;margin-bottom:6px">Select lists for CSV export</div>
        <div id="csvListPicker"></div>
      </div>
    </div>
    <div class="modal-foot">
      <button data-close class="ghost">Close</button>
    </div>
  </dialog>

  <!-- Fullscreen Photo Modal -->
  <dialog id="photoView">
    <div class="modal-head">
      <div id="photoViewTitle" class="title">Photo</div>
      <button data-close class="ghost">✖</button>
    </div>
    <div class="modal-body" style="display:flex;justify-content:center">
      <img id="photoViewImg" alt="Price tag" style="max-width:100%;max-height:60vh;border-radius:12px" />
    </div>
    <div class="modal-foot"><button data-close class="ghost">Close</button></div>
  </dialog>

  <script src="app.js" defer></script>
</body>
</html>
